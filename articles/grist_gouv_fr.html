<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>grist.numerique.gouv.fr (FR) • gristapi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="grist.numerique.gouv.fr (FR)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gristapi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/grist_gouv_fr.html">grist.numerique.gouv.fr (FR)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/spyrales/gristapi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>grist.numerique.gouv.fr (FR)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/spyrales/gristapi/blob/main/vignettes/grist_gouv_fr.Rmd" class="external-link"><code>vignettes/grist_gouv_fr.Rmd</code></a></small>
      <div class="hidden name"><code>grist_gouv_fr.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="utiliser-gristapi">Utiliser <code>gristapi</code><a class="anchor" aria-label="anchor" href="#utiliser-gristapi"></a>
</h2>
<div class="section level3">
<h3 id="récupérer-sa-clé-api">Récupérer sa clé API<a class="anchor" aria-label="anchor" href="#r%C3%A9cup%C3%A9rer-sa-cl%C3%A9-api"></a>
</h3>
<p>Tout utilisateur connecté à <a href="https://grist.numerique.gouv.fr" class="external-link uri">https://grist.numerique.gouv.fr</a> dispose d’une clé d’API
qui lui permet de lire/écrire dans les documents dans lesquels il a les
autorisations (voir <a href="https://support.getgrist.com/fr/" class="external-link uri">https://support.getgrist.com/fr/</a>).</p>
<p>Pour récupérer cette clé, il faut aller dans “Paramètres du compte”
depuis l’icone de votre profil.</p>
<p><img src="../reference/figures/para_compte.png" style="width: 40%;"></p>
<p>Puis en bas de la page, vous pouvez copiez votre clé d’API.</p>
<p><img src="../reference/figures/cles_api.png" style="width: 80%;"></p>
<p>Il est conseillé de mettre cette clé en variable d’environnement,
afin qu’elle n’apparaisse pas dans vos scripts R. Dans nos exemples,
cette clé sera injectée via <code>Sys.getenv("GRIST_KEY")</code>.</p>
</div>
<div class="section level3">
<h3 id="récupérer-lidentifiant-api-dun-document">Récupérer l’identifiant API d’un document<a class="anchor" aria-label="anchor" href="#r%C3%A9cup%C3%A9rer-lidentifiant-api-dun-document"></a>
</h3>
<p>Pour obtenir l’identifiant, il faut en premier se situer sur ce
document dans l’interface de Grist, puis de la même manière que
précédemment, aller dans “Paramètres du document” depuis l’icone de
votre profil.</p>
<p><img src="../reference/figures/para_doc.png" style="width: 40%;"></p>
<p>Puis dans la partie “API” de la page, vous pouvez copiez
l’identifiant du document.</p>
<p><img src="../reference/figures/doc_id.png" style="width: 80%;"></p>
<p>Même s’il n’est pas indispensable de mettre cet identifiant en
variable d’environnement, dans nos exemples, cet identifiant sera
injectée via <code>Sys.getenv("GRIST_DOC_TEST")</code>.</p>
</div>
<div class="section level3">
<h3 id="initialiser-la-connexion">Initialiser la connexion<a class="anchor" aria-label="anchor" href="#initialiser-la-connexion"></a>
</h3>
<p>La première chose à faire pour utiliser gristapi, c’est d’initialiser
la connexion à l’api Grist du document (qui lui peut contenir plusieurs
feuilles ou tables).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/spyrales/gristapi" class="external-link">gristapi</a></span><span class="op">)</span></span>
<span><span class="va">api</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/grist_api.html">grist_api</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="st">'https://grist.numerique.gouv.fr'</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GRIST_KEY"</span><span class="op">)</span>,</span>
<span>  doc_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GRIST_DOC_TEST"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Si aucun message d’erreur n’apparait, c’est que la connexion à votre
api c’est bien déroulé et que l’objet <code>api</code> peut désormais
être utiliser pour manipuler les données et les feuilles de votre
document depuis R.</p>
<p>Le détail des informations de votre connexion (métadonnées du
document) s’affiche en console, simplement en affichant l’objet :</p>
<pre><code><span><span class="va">api</span></span>
<span></span>
<span><span class="co">#&gt; [1] "-----------------"</span></span>
<span><span class="co">#&gt; [1] "grist_api print"</span></span>
<span><span class="co">#&gt; [1] "-----------------"</span></span>
<span><span class="co">#&gt; [1] "&lt;Document info&gt;"</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "Tests api_grist"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $createdAt</span></span>
<span><span class="co">#&gt; [1] "2025-07-21T08:37:26.704Z"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $updatedAt</span></span>
<span><span class="co">#&gt; [1] "2025-07-22T14:14:11.188Z"</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="va">...</span></span></code></pre>
<p>Les principales méthodes de l’objet ainsi créé sont <a href="../reference/grist_api.html#method-grist_api-call"><code>call()</code></a>,
<a href="../reference/grist_api.html#method-grist_api-table_to_json"><code>table_to_json()</code></a>,
<a href="../reference/grist_api.html#method-grist_api-json_to_table"><code>json_to_table()</code></a>.</p>
</div>
<div class="section level3">
<h3 id="créer-une-table">Créer une table<a class="anchor" aria-label="anchor" href="#cr%C3%A9er-une-table"></a>
</h3>
<p>Pour créer une table, on utilise la fonction <code>add_records</code>
avec l’option <code>create_or_replace=TRUE</code>. On assigne à la table
un identifiant sans espace ni caractères spéciaux
(<code>table_id</code>) et on lui soumet un <code>data.frame</code> à
injecter (<code>record_dicts</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_records.html">add_records</a></span><span class="op">(</span><span class="va">api</span>,</span>
<span>  table_id <span class="op">=</span> <span class="st">"iris"</span>,</span>
<span>  record_dicts <span class="op">=</span> <span class="va">iris</span>,</span>
<span>  create_or_replace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18</span></span>
<span><span class="co">#&gt;  [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36</span></span>
<span><span class="co">#&gt;  [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54</span></span>
<span><span class="co">#&gt;  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72</span></span>
<span><span class="co">#&gt;  [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90</span></span>
<span><span class="co">#&gt;  [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108</span></span>
<span><span class="co">#&gt; [109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126</span></span>
<span><span class="co">#&gt; [127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144</span></span>
<span><span class="co">#&gt; [145] 145 146 147 148 149 150</span></span></code></pre></div>
<p>Cette fonction renvoie le vecteur des id (entiers) créés dans la
table.</p>
<p>A savoir, toutes les tables (ou feuilles), créées dans Grist, ont un
identifiant commençant par une majuscule ! De même, si vos noms de
colonnes comportent des “.”, il seront automatiquement remplacés par des
“_“.</p>
<p>Il est donc conseillé d’utiliser les fonctions
<code><a href="../reference/listtables.html">listtables()</a></code> et <code><a href="../reference/listcolumns.html">listcolumns()</a></code> après avoir créé
une table pour s’assurer que le nommage de la structure n’affectera pas
vos traitements ultérieurs.</p>
</div>
<div class="section level3">
<h3 id="explorer-les-données-dune-table">Explorer les données d’une table<a class="anchor" aria-label="anchor" href="#explorer-les-donn%C3%A9es-dune-table"></a>
</h3>
<p>Pour importer dans R les données d’une table, on utilise la fonction
<code>fetch_table</code>. En l’absence de l’option <code>filters</code>,
on rappatrie toutes les données de la table.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">giris</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">giris</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;      id Sepal_Length Sepal_Width Petal_Length Petal_Width Species</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1          5.1         3.5          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2          4.9         3            1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3          4.7         3.2          1.3         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4          4.6         3.1          1.5         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5          5           3.6          1.4         0.2 setosa </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6          5.4         3.9          1.7         0.4 setosa</span></span></code></pre></div>
<p>Si on souhaite filtrer avant d’importer les données (utile pour les
tables de grande dimension), on doit fournir un filtre rédigé comme
l’indique la <a href="https://support.getgrist.com/fr/api/#tag/records/operation/listRecords" class="external-link">documentation
Grist</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gvirginica</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, filters <span class="op">=</span> <span class="st">'filter={"Species": ["virginica"]}'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gvirginica</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;      id Sepal_Length Sepal_Width Petal_Length Petal_Width Species  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   101          6.3         3.3          6           2.5 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   102          5.8         2.7          5.1         1.9 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   103          7.1         3            5.9         2.1 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   104          6.3         2.9          5.6         1.8 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   105          6.5         3            5.8         2.2 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   106          7.6         3            6.6         2.1 virginica</span></span></code></pre></div>
<p>Il est également possible de trier les données et d’en limiter le
nombre de lignes</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbigpetal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, filters <span class="op">=</span> <span class="st">'sort=-Petal_Width&amp;limit=10'</span><span class="op">)</span></span>
<span><span class="va">gbigpetal</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 6</span></span></span>
<span><span class="co">#&gt;       id Sepal_Length Sepal_Width Petal_Length Petal_Width Species  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   101          6.3         3.3          6           2.5 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   110          7.2         3.6          6.1         2.5 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   145          6.7         3.3          5.7         2.5 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   115          5.8         2.8          5.1         2.4 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   137          6.3         3.4          5.6         2.4 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   141          6.7         3.1          5.6         2.4 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   116          6.4         3.2          5.3         2.3 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   119          7.7         2.6          6.9         2.3 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   121          6.9         3.2          5.7         2.3 virginica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   136          7.7         3            6.1         2.3 virginica</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ajouter-modifier-et-supprimer-des-entrées">Ajouter, modifier et supprimer des entrées<a class="anchor" aria-label="anchor" href="#ajouter-modifier-et-supprimer-des-entr%C3%A9es"></a>
</h3>
<p>Pour <strong>ajouter</strong> des entrée dans une table, on utilise,
à nouveau, la fonction <code>add_records</code>. Le data.frame soumis ne
doit pas contenir de colonne nommée <code>id</code> et sa structure doit
être identique à celle de la table de destination.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Sepal_Length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.5</span>,<span class="fl">6.2</span><span class="op">)</span>, </span>
<span>  Sepal_Width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.9</span>,<span class="fl">3.3</span><span class="op">)</span>, </span>
<span>  Petal_Length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.5</span>,<span class="fl">3.1</span><span class="op">)</span>, </span>
<span>  Petal_Width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.4</span>,<span class="fl">6.9</span><span class="op">)</span>, </span>
<span>  Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"missouriensis"</span>,<span class="st">"missouriensis"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/add_records.html">add_records</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, <span class="va">records</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 151 152</span></span></code></pre></div>
<p>Cette fonction renvoie un vecteur d’entier contenant les
<code>id</code> des nouvelles entrées, si l’enregistrement s’est déroulé
correctement (seuls les 500 premiers id sont retournés).</p>
<p>Pour <strong>modifier</strong> des entrée dans une table, on utilise
la fonction <code>update_records</code>. Le data.frame soumis doit
contenir une colonne nommée <code>id</code> afin de cibler les entrées à
mettre à jour. La structure doit être contenue par celle de la table de
destination.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Sepal_Length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.1</span>,<span class="fl">5.0</span><span class="op">)</span>, </span>
<span>  Sepal_Width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.5</span>,<span class="fl">3.1</span><span class="op">)</span>, </span>
<span>  Petal_Length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">1.4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/update_records.html">update_records</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, <span class="va">records</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Cette fonction renvoie TRUE si l’enregistrement s’est déroulé
correctement.</p>
<p>Pour <strong>supprimer</strong> des entrée dans une table, on utilise
la fonction <code>delete_records</code>. On soumet un vecteur d’entiers
contenant les <code>id</code> des entrées à supprimer.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/delete_records.html">delete_records</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Cette fonction renvoie TRUE si la suppression s’est déroulé
correctement.</p>
</div>
<div class="section level3">
<h3 id="remplacer-ou-synchroniser-la-table">Remplacer ou synchroniser la table<a class="anchor" aria-label="anchor" href="#remplacer-ou-synchroniser-la-table"></a>
</h3>
<p>Pour <strong>remplacer</strong> toute les données d’une table, il
faut comme à la création de la table, utiliser la fonction
<code>add_records</code> avec l’option
<code>create_or_replace=TRUE</code>. Dans ce cas, on supprime et recrée
une nouvelle table avec le même identifiant, on peut donc modifier la
structure (attention dans ce cas vous perdrez les éventuels filtres,
styles ou relations sauvegargés depuis l’interface Grist).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldiris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newiris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>my_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">oldiris</span><span class="op">)</span>, <span class="va">oldiris</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/add_records.html">add_records</a></span><span class="op">(</span><span class="va">api</span>,</span>
<span>  table_id <span class="op">=</span> <span class="st">"Iris"</span>,</span>
<span>  record_dicts <span class="op">=</span> <span class="va">newiris</span>,</span>
<span>  create_or_replace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18</span></span>
<span><span class="co">#&gt;  [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36</span></span>
<span><span class="co">#&gt;  [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54</span></span>
<span><span class="co">#&gt;  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72</span></span>
<span><span class="co">#&gt;  [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90</span></span>
<span><span class="co">#&gt;  [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108</span></span>
<span><span class="co">#&gt; [109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126</span></span>
<span><span class="co">#&gt; [127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144</span></span>
<span><span class="co">#&gt; [145] 145 146 147 148 149 150</span></span></code></pre></div>
<p>L’api Grist prévoit une méthode de synchronisation qui en fonction
d’une clé unique, soit ajoute l’entrée, soit met à jour celle existante.
Ainsi, pour <strong>synchroniser</strong> un data.frame à une table, on
utilise la fonction <code>sync_table</code>. Le data.frame soumis ne
doit pas contenir de colonne nommée <code>id</code> et sa structure doit
être identique à celle de la table de destination. La clé unique peut
être sur un ou plusieurs champs.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, filters <span class="op">=</span> <span class="st">'filter={"Species": ["missouriensis"]}'</span><span class="op">)</span></span>
<span><span class="va">new_data</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="st">"japonica"</span></span>
<span><span class="va">new_data</span><span class="op">$</span><span class="va">my_id</span><span class="op">[</span><span class="va">new_data</span><span class="op">$</span><span class="va">my_id</span> <span class="op">==</span> <span class="fl">150</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">151</span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="va">new_data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   my_id Sepal_Length Sepal_Width Petal_Length Petal_Width Species </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   149          6.5         2.9          3.5         7.4 japonica</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   151          6.2         3.3          3.1         6.9 japonica</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sync_table.html">sync_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span>, <span class="va">new_data</span>, key_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_id"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="../reference/fetch_table.html">fetch_table</a></span><span class="op">(</span><span class="va">api</span>, <span class="st">"Iris"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id my_id Sepal_Length Sepal_Width Petal_Length Petal_Width Species      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   146   146          6.5         3            5.2         2   virginica    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   147   147          6.2         3.4          5.4         2.3 virginica    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   148   148          5.9         3            5.1         1.8 virginica    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   149   149          6.5         2.9          3.5         7.4 japonica     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   150   150          6.2         3.3          3.1         6.9 missouriensis</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   151   151          6.2         3.3          3.1         6.9 japonica</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="utilisation-avancée">Utilisation avancée<a class="anchor" aria-label="anchor" href="#utilisation-avanc%C3%A9e"></a>
</h2>
<p>Il est possible de customiser ses requêtes d’exploration dans les
tables en utilisant le “endpoint” <code>sql</code> et la méthode
<code>call</code> de gristapi.</p>
<p>Exemples :</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">req_sql</span> <span class="op">&lt;-</span> <span class="st">"select * from Iris where Sepal_Length &gt; 5 and Sepal_Width &lt; 4"</span></span>
<span></span>
<span><span class="va">api</span><span class="op">$</span><span class="fu">json_to_table</span><span class="op">(</span></span>
<span>  <span class="va">api</span><span class="op">$</span><span class="fu">call</span><span class="op">(</span></span>
<span>    url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/sql?q="</span>,<span class="fu"><a href="https://rdrr.io/r/utils/URLencode.html" class="external-link">URLencode</a></span><span class="op">(</span><span class="va">req_sql</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    type_resp <span class="op">=</span> <span class="st">"string"</span></span>
<span>  <span class="op">)</span>, </span>
<span>  <span class="st">"records"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 117 × 8</span></span></span>
<span><span class="co">#&gt;       id manualSort my_id Sepal_Length Sepal_Width Petal_Length Petal_Width</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1          1     1          5.1         3.5          1.5         0.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     4          4     4          5.4         3.9          1.7         0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     9          9     9          5.4         3.7          1.5         0.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    15         15    15          5.4         3.9          1.3         0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    16         16    16          5.1         3.5          1.4         0.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    17         17    17          5.7         3.8          1.7         0.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    18         18    18          5.1         3.8          1.5         0.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    19         19    19          5.4         3.4          1.7         0.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    20         20    20          5.1         3.7          1.5         0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    22         22    22          5.1         3.3          1.7         0.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 107 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: Species &lt;chr&gt;</span></span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Edouard Morin, Juliette ENGELAERE-LEFEBVRE.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
